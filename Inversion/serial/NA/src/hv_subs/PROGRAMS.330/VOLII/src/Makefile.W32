#####
#	TEST VOLII DEVELOPMENT
#####


#####
#	LINUX
#####
FCMP=g77  -Wall
CCMP= gcc -DMSDOS -I../../CALPLOT/include/
CALPLTPF=../../lib/libcalpltf.a
CALPLTVC=../../lib/libcalmswc.a ../../lib/lg.a
CALPLTVF=../../lib/libcalmswf.a ../../lib/lg.a
LDFLAGS		=  -lm -Wl,--subsystem,console -mwindows
DEST=../../bin

SUBS=lgstr.o mnmarg.o mgtarg.o sacsubf.o mchdep.o
GSUBSF=grphsubf.o
GSUBSC=grphsubc.o

RM=rm -f

.f.o:
	$(FCMP) -c $<

.c.o:
	$(CCMP) -c $<

all:	calplot.h do_mft do_pom sacmat96 sacmft96 sacpom96 domftsrf clean

lgstr.f:
	cp ../../SUBS/lgstr.f .
mchdep.f:
	cp ../../SUBS/mchdep.f .
mnmarg.f:
	cp ../../SUBS/mnmarg.f .
mgtarg.f:
	cp ../../SUBS/mgtarg.f .
rddisp.f:
	cp ../../VOLIII/src/rddisp.f .
sacsubf.f:
	cp ../../SUBS/sacsubf.f .
calplot.h:
	cp ../../CALPLOT/include/calplot.h .
sacsubc.h:
	cp ../../SUBS/sacsubc.h .
sacsubc.c:
	cp ../../SUBS/sacsubc.c .
csstime.h:
	cp ../../SUBS/csstime.h .
csstime.c:
	cp ../../SUBS/csstime.c .
csstime.o: csstime.c csstime.h
	$(CCMP) -c csstime.c
grphsubf.f:
	cp ../../SUBS/grphsubf.f .
grphsubf.o: grphsubf.f
	$(FCMP) -c grphsubf.f
grphsubc.c:
	cp ../../SUBS/grphsubc.c .
grphsubc.h:
	cp ../../SUBS/grphsubc.h .
grphsubc.o: grphsubc.c grphsubc.h
	$(CCMP) -c grphsubc.c
sacsubf.o: sacsubf.f
	$(FCMP) -c sacsubf.f
lgstr.o: lgstr.f
	$(FCMP) -c lgstr.f
mchdep.o: mchdep.f
	$(FCMP) -c mchdep.f
mnmarg.o: mnmarg.f
	$(FCMP) -c mnmarg.f
mgtarg.o: mgtarg.f
	$(FCMP) -c mgtarg.f
rddisp.o: rddisp.f
	$(FCMP) -c rddisp.f


sacmft96:	sacmft96.o bubs.o solidf.o $(GSUBSF) $(SUBS) 
	$(FCMP) sacmft96.o bubs.o solidf.o $(GSUBSF) $(SUBS) $(CALPLTPF) -o sacmft96.exe
	mv sacmft96.exe $(DEST)

sacmat96:	sacmat96.o rddisp.o  $(GSUBSF) $(SUBS) 
	$(FCMP) sacmat96.o rddisp.o  $(GSUBSF) $(SUBS) $(CALPLTVF) $(LDFLAGS) -o sacmat96.exe
	mv sacmat96.exe $(DEST)


sacpom96:	sacpom96.o bubs.o solidf.o $(GSUBSF) $(SUBS) 
	$(FCMP) sacpom96.o bubs.o solidf.o $(GSUBSF) $(SUBS) $(CALPLTPF) -o sacpom96.exe
	mv sacpom96.exe $(DEST)


domftsrf:
	cp MFTSRF $(DEST)
	chmod +x $(DEST)/MFTSRF


#####
#	C programs
#####


do_mft4.c: grphsubc.h 
do_mft2.c: csstime.h 
do_mft.c: csstime.h 
do_pom.c: csstime.h 

do_mft:	do_mft.o do_mft1.o fmenunod.o do_mft2.o do_mft3.o do_mft4.o sacsubc.o csstime.o sup.o $(GSUBSC) solidc.o 
	$(CCMP) do_mft.o do_mft1.o fmenunod.o do_mft2.o do_mft3.o do_mft4.o sacsubc.o csstime.o sup.o $(GSUBSC) solidc.o $(CALPLTVC) $(LDFLAGS) -o do_mft.exe
	wc do_mft.c do_mft?.c fmenunod.c do_mft[234].c sacsubc.c csstime.c sup.c solidc.c grphsubc.c
	mv do_mft.exe $(DEST)

do_mft.o:	do_mft.c sacsubc.h grphsubc.h 
	$(CCMP) -c do_mft.c


do_pom4.c: grphsubc.h 

do_pom:	do_pom.o do_pom1.o fmenunod.o do_pom3.o do_pom4.o sacsubc.o csstime.o sup.o $(GSUBSC) solidc.o 
	$(CCMP) do_pom.o do_pom1.o fmenunod.o do_pom3.o do_pom4.o sacsubc.o csstime.o sup.o $(GSUBSC) solidc.o $(CALPLTVC) $(LDFLAGS) -o do_pom.exe
	mv do_pom.exe $(DEST)

do_pom.o:	do_pom.c sacsubc.h grphsubc.h 
	$(CCMP) -c do_pom.c

clean:
	$(RM) *.o
	$(RM) mchdep.f lgstr.f mnmarg.f mgtarg.f grphsubc.c grphsubc.h grphsubf.f
	$(RM) sacsubf.f sacsubc.c sacsubc.h
	$(RM) csstime.c csstime.h calplot.h

